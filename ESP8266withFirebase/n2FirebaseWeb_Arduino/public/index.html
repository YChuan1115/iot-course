<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Robert_arduino_control_Web</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!--自訂的Css-->
    <style type="text/css">
      .bg-primary,.bg-danger{
        padding:10px;
        text-align:center;
        line-height:1.8em
      }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <!-- 形象Banner開始 -->
    <div class="jumbotron">
      <div class="container">
        <h1>Robert Arduino Web Control</h1>
        <p>這是透過網頁來控制Arduino的介面</p>        
      </div>
    </div>
    <!-- 形象Banner結束 -->

    <!-- 控制內容開始 -->
    <!-- led Control 開始-->
<div class="container-fluid">
  <h4>Led控制</h4>
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <blockquote>
        <p>控制LED明亮</p>
      </blockquote>
    </div>
    <div class="col-xs-12 col-sm-6">
      <div class="btn-group btn-group-lg" role="group" aria-label="led">
        <button type="button" class="btn btn-danger" id="openBtn">開</button>
        <button type="button" class="btn btn-default" id="closeBtn">關</button>       
      </div>
    </div>
  </div>
</div>
    <!-- led Control 結束 -->
<br>
<br>
<br>
    <!-- RGB Switch 開始 -->
  <div class="container-fluid">
    <h4>RGB Switc控制</h4>
    <div class="row">
      <div class="col-xs-12 col-sm-6">
        <blockquote>
          <p>切換RGB</p>
        </blockquote>
      </div>
      <div class="col-xs-12 col-sm-6">
        <div class="btn-group btn-group-lg" role="group" aria-label="..." id="rgbSwitch">
          <button type="button" class="btn btn-danger" id="rSwitch">紅</button>
          <button type="button" class="btn btn-success" id="gSwitch">綠</button>
          <button type="button" class="btn btn-primary" id="bSwitch">藍</button>
        </div>
      </div>
    </div>
  </div>
    <!-- RGB Switch 結束 -->
<br>
<br>
<br>
  <!-- LCD 內容開始 -->
<div class="container-fluid">
  <h4>LCD_Relay 內容控制</h4>
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <blockquote>
        <p>LCD_Relay</p>
      </blockquote>
    </div>
    <div class="col-xs-12 col-sm-6">
      <!-- First Input Field -->
      <div class="input-group">
        <input type="text" class="form-control" placeholder="First Line..." id="line1Field">
        <span class="input-group-btn">
                  <button class="btn btn-default" type="button" id="line1Btn">Go!</button>
                </span>
      </div>
      <br/>
      <!-- Second Input Field -->
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Second Line..." id="line2Field">
        <span class="input-group-btn">
                  <button class="btn btn-default" type="button" id="line2Btn">Go!</button>
                </span>
      </div>
    </div>
  </div>
  <br>
  <h4>Relay1</h4>
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <!-- Relay１ 控制 -->
      <div class="btn-group btn-group-lg" role="group" aria-label="led">
        <button type="button" class="btn btn-danger" id="relay1OpenBtn">開</button>
        <button type="button" class="btn btn-default" id="relay1CloseBtn">關</button>
      </div>
    </div>
    <!-- Relay１ 控制結束 -->
  </div>
  <br>
  <h4>Relay2</h4>
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <!-- Relay２ 控制 -->
      <div class="btn-group btn-group-lg" role="group" aria-label="led">
        <button type="button" class="btn btn-danger" id="relay2OpenBtn">開</button>
        <button type="button" class="btn btn-default" id="relay2CloseBtn">關</button>
      </div>
    </div>
  </div>
</div>
<!-- Relay２ 控制結束 -->
<!-- LCD 內容結束 -->

<!-- Home 開始 -->
<br>
<br>
<br>
    <div class="container-fluid">
      <h4>Home控制</h4>
      <div class="row">
        <div class="col-xs-12 col-sm-6">
          <blockquote>
            <p>溫度,濕度,聲音,窗戶開關偵測</p>
          </blockquote>
        </div>
        
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-6">
          <button class="btn btn-primary" type="button">
          溫度 <span class="badge" id="temperature">4</span>
          </button>

          <button class="btn btn-primary" type="button">
          濕度 <span class="badge" id="humidity">4</span>
          </button>
        </div>
        
      </div>
      <br>
      <br>
      <div class="row">
        <div class="col-xs-12 col-sm-6">
          <button class="btn btn-primary" type="button">
          聲音 <span class="badge" id="sound">4</span>
          </button>

          <button class="btn btn-primary" type="button">
          窗戶開關 <span class="badge" id="window">4</span>
          </button>
        </div>
        
      </div>
          
       
    </div>

<!-- Home 結束 -->

<!-- RFID 開始 -->
<br>
<br>
<br>
    <div class="container-fluid">
      <h4>RFID控制</h4>
      <div class="row">
        <div class="col-xs-12 col-sm-6">
          <blockquote>
            <p>門禁管理</p>
          </blockquote>
        </div>
        
      </div>

      <div class="row">
        <div class="col-xs-12 col-sm-12 records"　id="records">
          <!--
          <p class="bg-primary">
            <span>日期時間:2017/07/12 13:52:50</span><br/>
            <span>識別帳號:4A-78-3F-56-3D</span>              
          </p>
          -->
        </div>
        
      </div>
      <br>
      <br>
      
          
       
    </div>

<!-- RFID 結束 -->
    <!-- 控制內容結束 -->
    <!--Firebase JavaScript plugins) -->
    <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--自訂的程式-->
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyCBa3cc1A9mlWzDnG_0e9ltIcZhOWiA-tk",
        authDomain: "arduinofirebase-6d104.firebaseapp.com",
        databaseURL: "https://arduinofirebase-6d104.firebaseio.com",
        projectId: "arduinofirebase-6d104",
        storageBucket: "arduinofirebase-6d104.appspot.com",
        messagingSenderId: "775007261514"
      };
      firebase.initializeApp(config);
      //自已寫的程式
      var database = firebase.database();

      //led
      $(document).ready(function(){
        var ledRef = database.ref('led/');
        
        ledRef.on('value',function(snapShot){
          
          if(snapShot.val().D2){
            $('#openBtn').trigger("click");
          }else{
            $('#closeBtn').trigger("click");
          }
        });

        $('#openBtn').click(function(){
          
          $(this).removeClass().addClass("btn").addClass("btn-danger");
          $('#closeBtn').removeClass().addClass("btn").addClass("btn-default");
          ledRef.update({'D2':true});
        });

        $('#closeBtn').click(function(){
          
          $(this).removeClass().addClass("btn").addClass("btn-danger");
          $('#openBtn').removeClass().addClass("btn").addClass("btn-default");
          ledRef.update({'D2':false});
        });


      });

      //rgb
      $(document).ready(function(){
        var rgbRef = database.ref("RGBSwitch/");
        rgbRef.once('value',function(snapshot){          
          var resultJson = snapshot.val();
          if (resultJson.R) {
            $('#rSwitch').trigger("click");
          }else if (resultJson.G) {
            $('#gSwitch').trigger("click");
          }else if (resultJson.B) {
              $('#bSwitch').trigger("click");
          }
        });
        
       $('#rgbSwitch button').removeClass().addClass('btn btn-default');

        $('#rSwitch').click(function(){
           $('#rgbSwitch button').removeClass().addClass('btn btn-default');
           $(this).removeClass().addClass('btn btn-danger');
           var newUpdateData = {};
           newUpdateData["R"] = true;
           newUpdateData["G"] = false;
           newUpdateData["B"] = false;
           rgbRef.update(newUpdateData);
        });

        $('#gSwitch').click(function(){
           $('#rgbSwitch button').removeClass().addClass('btn btn-default');
           $(this).removeClass().addClass('btn btn-success');
           var newUpdateData = {};
           newUpdateData["R"] = false;
           newUpdateData["G"] = true;
           newUpdateData["B"] = false;
           rgbRef.update(newUpdateData);
        });

        $('#bSwitch').click(function(){
           $('#rgbSwitch button').removeClass().addClass('btn btn-default');
           $(this).removeClass().addClass('btn btn-primary');
           var newUpdateData = {};
           newUpdateData["R"] = false;
           newUpdateData["G"] = false;
           newUpdateData["B"] = true;
           rgbRef.update(newUpdateData);
        });
      });

      //LCD_Relay
      $(document).ready(function(){
        var lcdRef = database.ref("lcd");
        lcdRef.on('value',function(snapshot){
          var lcdData = snapshot.val();
          //console.log(lcdData.line1);
          //console.log(lcdData.line2);
          //console.log(lcdData.relay1);
          //console.log(lcdData.relay2);
          $('#line1Field').val(lcdData.line1);
          $('#line2Field').val(lcdData.line2);

          if(lcdData.relay1){
             $('#relay1OpenBtn').trigger('click');
          }else{
            $('#relay1CloseBtn').trigger('click');
          }

          if(lcdData.relay2){
             $('#relay2OpenBtn').trigger('click');
          }else{
            $('#relay2CloseBtn').trigger('click');
          }
         
        });

        $('#line1Btn').click(function(){
          var line1String = $('#line1Field').val();
          var line1Ref = database.ref("lcd/line1");
          line1Ref.set(line1String);
        });

         $('#line2Btn').click(function(){
          var line2String = $('#line2Field').val();
          var line2Ref = database.ref("lcd/line2");
          line2Ref.set(line2String);
        });

        var relay1Ref = database.ref("lcd/relay1");
        $('#relay1OpenBtn').click(function(){          
          $(this).removeClass().addClass("btn").addClass("btn-danger");
          $('#relay1CloseBtn').removeClass().addClass("btn").addClass("btn-default");
          relay1Ref.set(true);
        });

        $('#relay1CloseBtn').click(function(){          
          $(this).removeClass().addClass("btn").addClass("btn-danger");
          $('#relay1OpenBtn').removeClass().addClass("btn").addClass("btn-default");
          relay1Ref.set(false);
        });

        var relay2Ref = database.ref("lcd/relay2");
        $('#relay2OpenBtn').click(function(){          
          $(this).removeClass().addClass("btn").addClass("btn-danger");
          $('#relay2CloseBtn').removeClass().addClass("btn").addClass("btn-default");
          relay2Ref.set(true);
        });

        $('#relay2CloseBtn').click(function(){          
          $(this).removeClass().addClass("btn").addClass("btn-danger");
          $('#relay2OpenBtn').removeClass().addClass("btn").addClass("btn-default");
          relay2Ref.set(false);
        });       
       
      });

      //Home
      $(document).ready(function(){
          var homeRef = database.ref("home");
          homeRef.on('value',function(snapshot){
            var homeValue = snapshot.val();            
            $('#temperature').text(homeValue.temp);
            $('#humidity').text(homeValue.humidity);
            $('#sound').text(homeValue.sound);
            $('#window').text(homeValue.window ?　'開'　:　'關');
          });
      });

      //RFID
      $(document).ready(function(){
        var recordsRef = database.ref("rfid/records");
        var limitedCount = 5;
        var sortedRecords = recordsRef.orderByKey().limitToLast(limitedCount);
        sortedRecords.on('value',function(snapshot){
          $('.records').empty();
          var json = snapshot.val();
          var i = 0;
          var active = false;//note最後一筆
          for (key in json){
            if(++i == limitedCount){
              active = true;
            }else{
              active = false;
            }
            var item = json[key];
            var cardID;
            var time;

            for (key in item){
              if (key == "card"){
                cardID = item[key];
              }else{
                time = item[key];
              }
            }

            var date = new Date(time);
            var dateString = date.getFullYear() + "/" + (date.getMonth()+1) + "/" + date.getDate() + "-" + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
               $('<p class="' + (active ? 'bg-danger':'bg-primary' ) + '">' + '<span>日期時間:' + dateString +'</span><br/>' + '<span>識別帳號:' + cardID +'</span></p>').prependTo('.records');
               console.log(key);
          }

          $('p.bg-danger').hide().show(500);
         
          
          
        })
      });
    </script>
  </body>
</html>